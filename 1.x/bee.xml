<?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE bee PUBLIC "-//Dmitriy Rogatkin//DTD Bee Project Builder 1.0//EN"
    "http://knitknot.info/DTD/bee.dtd" [
      <!ENTITY env SYSTEM "./env.xml">
      <!ENTITY build_directory "lib">
      <!ENTITY launchername "webapplauncher">
      <!ENTITY re_sl "\\"> <!-- re_sl "\\" for Windows and "/" for POSIX -->
      ]>

<!-- 
  The 7Bee build script used for TJWS project
   Copyright (c) 2005-2015 Dmitriy Rogatkin  
  -->

<bee name="tjws" type="project">
  &env;
  <expression variable="attention message">
     <operator name="append">
        <value>     ================ ATTENTION ==================
     Please make sure that below variables obtained correct values
     in file env.xml for build correctness:

      SERVLET_LIB - fully qualified path to servlet.jar or other lib/directory containing 
                    JSS 2.3 classes (this one is used for building base TJWS)
                    = </value>
        <value variable="SERVLET_LIB"/>
        <value>
      SERVLET_LIB_30 - fully qualified path to javax.servlet.jar or other lib/directory
                     containing JSS 3.x classes (used for J2EE extension)
                     =</value>
        <value variable="SERVLET_LIB_30"/>
        <value>
      SERVLET_SRC - fully qualified path to sources of JSS classes, used only for packaging 
                    text resources in a launcher (optional) 
                    = </value>
        <value variable="SERVLET_SRC"/>
        <value>
      SERVLET_BUILD - fully qualified path to binaries of classes of JSS, used only for 
                      packaging JSS in a launcher (correct version of JSS
                      has to be used for target applications (optional) 
                    = </value>
        <value variable="SERVLET_BUILD"/>
        <value>
      JSP_LIB - fully qualified path to jsp.jar or other lib/directory containing 
                JSP API classes, unless JASPER library is defined (optional)
                    = </value>
        <value variable="JSP_LIB"/>
        <value>
      JASPER (optional)
                    = </value>
        <value variable="JASPER"/> 
        <value>
      ANDROID_RT (optional for android compilation)
                    =</value>
        <value variable="ANDROID_RT"/> 
        <value>
      WEBSOCKET_CLIENT_LIB, EBSOCKET_SERVER_LIB - websocket (JSR356) API libraries (optional)
                    =</value>
        <value variable="WEBSOCKET_CLIENT_LIB"/> 
        <value> </value>
        <value variable="WEBSOCKET_SERVER_LIB"/> 
        <value>
      WEBSOCKET_API - fully qualified path to websocket spec source api directory (optional)
                   =</value>
        <value variable="WEBSOCKET_API"/> 
        <value>
      CLASS_SCAN_LIB, CLASS_SCAN_CLASSES - fully qualified paths to fast scan library and classes tree (optional)
                   =</value>
        <value variable="CLASS_SCAN_LIB"/>
        <value> </value>
        <value variable="CLASS_SCAN_CLASSES"/>   
       <value>
     =============================================</value>
     </operator>
  </expression>
  
  <echo variable="attention message"/>
  
  <expression variable="javac">
     <operator name="append">
        <value variable="JAVA_HOME"/>
        <value>/bin/javac</value>
     </operator>
  </expression>
  
  <expression  variable="idl compiler">     
     <operator name="append">
        <value variable="JAVA_HOME"/>
        <value>/bin/idlj</value>
     </operator>
  </expression>
  

  <target name="check lib" dir="TJWS_HOME" comment="assure build directory">
     <dependency>
        <expression>
          <operator name="eq">
            <function name ="timestamp">
               <parameter value="&build_directory;"/>
            </function>
            <value/>
          </operator>
        </expression>
     </dependency>
     <block>
       <function name="mkd">
         <parameter value="&build_directory;"/>
       </function>
     </block>
  </target>
  
  <variable name="compatib dir" type="path">./compatibility</variable>
  <expression name="bee start">
      <if>
        <expression>
           <operator name="eq">
             <value variable="PATH SEPARATOR"/>
             <value>:</value>
           </operator>
         </expression>
         <then>
           <value>bee</value>
         </then>
         <else>
           <value>bee.bat</value>
         </else>
     </if>
   </expression>
             
  <target name="check compatibility" dir="TJWS_HOME" comment="assure that compatibility jar is built">
      <dependency>
         <function name="anynewer">
            <parameter value="./compatibility/build/compat-jsr315+.jar"/>
            <parameter value="./compatibility/bee.xml"/>
         </function>
      </dependency>
      <task name="compatib build" exec="bee start" dir="compatib dir">
          <parameter>jar</parameter>
      </task>
  </target>

  <expression variable="tjws sources">
      <operator name="array">
        <!--value variable="tjws sources"/-->
        <function name="newerwithdependency">
           <parameter value="src\Acme\.java"/>
           <parameter value="&build_directory;\Acme\.class"/>
           <parameter value=""/>
           <parameter value="Acme"/>
        </function>
     </operator>
  </expression>

  <expression variable="checker sources">
      <operator name="array">
        <function name="newerthan">
           <parameter value="src\oracle\.java"/>
           <parameter value="&build_directory;\oracle\.class"/>
        </function>
        <function name="newerthan">
           <parameter value="src\mysql\.java"/>
           <parameter value="&build_directory;\mysql\.class"/>
        </function>
      </operator>
  </expression>  

  <expression variable="class path">
     <operator name="append">
        <value>&build_directory;</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="SERVLET_LIB"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="SERVLET_LIB_30_COMPAT"/>
     </operator>
  </expression>

  <expression variable="j2ee class path">
     <operator name="append">
        <value>&build_directory;</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="SERVLET_LIB_30"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="WEBSOCKET_CLIENT_LIB"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="WEBSOCKET_SERVER_LIB"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="CLASS_SCAN_LIB"/>
     </operator>
  </expression>
  
  <expression variable="IDL sources">
    <function name="anynewer">
       <parameter value="idl"/>
       <parameter value="src/rogatkin/app/remote"/>
    </function>
  </expression>

  <target name="help">
     <echo>
//////////////////// TJWS Build Process /////////////////////////
  type: 
  bee -th 
  to get help on build targets
/////////////////////////////////////////////////////////////////
    </echo>
  </target>

  <target name="compile" dir="TJWS_HOME" comment="Core module compilation">
    <dependency target="check lib"/>
    <dependency target="check compatibility"/>
    <dependency variable="tjws sources"/>
    <echo>Compiling core...</echo>
    <task exec="javac">
       <parameter value="-classpath"/>
       <parameter variable="class path"/>
       <parameter value="-source"/>
       <parameter variable="target version"/>
       <parameter value="-target"/>
       <parameter >
          <expression>
            <if>
               <expression>
                   <operator name="eq">
                        <value variable="android"/>
                        <value>yes</value>
                   </operator>
               </expression>
               <then>
                  <expression name="target version">
                      <value>1.7</value>
                  </expression>
               </then>
               <else>
                    <value variable="target version"/>
               </else>
           </if>
         </expression>  
       </parameter>
       <parameter>
          <expression>
            <if>
              <expression>
                <operator name="lt">
                   <value variable="target version"/>
                   <value>1.5</value>
                </operator>
              </expression>
              <block type="then">
                 <operator name="array">
                   <value>-bootclasspath</value>
                   <value variable="target runtime"/>
                 </operator>
              </block>
            </if>   
          </expression>
       </parameter> 
       <parameter value="-d"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter>
          <expression>
            <if>
              <expression>
                 <operator name="eq">
                    <value variable="tjws sources"/>
                    <operator name="array"></operator>
                 </operator>
              </expression>
              <block type="else">
                 <value variable="tjws sources"/>
              </block>
              <block type="then">
                 <value>src/Acme/Utils.java</value>
              </block>
           </if>
          </expression>
       </parameter> 
      <onexit>
        <if>
          <expression>
             <operator name="neq"><value variable="resultcode"/><value>0</value></operator>
          </expression>
          <block type="then">
                 <echo>Error(s) at compilation</echo>
                 <function name="stop">
			<parameter value="1"/>
                 </function>
          </block>
       </if>
      </onexit>
    </task>
  </target>

  <target name="idl" dir="TJWS_HOME" comment="IDL files creation for JNDI (app module)">
     <dependency variable="IDL sources"/>
     <echo>IDL compilation...</echo>
     <task name="idl compilation" exec="idl compiler">
         <parameter value="-keep"/>
         <parameter value="-fall"/>
         <parameter value="-td"/>
         <parameter value="src"/>
         <parameter value="-pkgTranslate"/>
         <parameter value="app"/>
         <parameter value="rogatkin.app.remote"/>
         <parameter value="idl/remotecontext.idl"/>
     </task>
  </target>

  <variable name="j2ee sources"/>
  
  <target name="create j2ee sources">
     <dependency value="true"/>
     <block>
		  <expression variable="j2ee sources">
		     <if>
		       <expression>
                         <operator name="or">
  		            <operator name="lt">
		               <value variable="j2ee target version"/>
		               <value>1.6</value>
		            </operator>   
                            <operator name="eq">
                               <value variable="android"/>
                               <value>yes</value>
                            </operator>
                         </operator>
		       </expression>
		       <then>
		         <operator name="exclude">
		          <function name="newerwithdependency">
		             <parameter value="src\rogatkin\.java"/>
		             <parameter value="&build_directory;\rogatkin\.class"/>
		             <parameter value=""/>
		             <parameter value="rogatkin"/>
		          </function>
		          <value>.*SysTrayControl\.java</value>
		         </operator>
		       </then>
		       <else>
		          <function name="newerwithdependency">
		             <parameter value="src\rogatkin\.java"/>
		             <parameter value="&build_directory;\rogatkin\.class"/>
		             <parameter value=""/>
		             <parameter value="rogatkin"/>
		          </function>
		       </else>
		     </if>
		  </expression>
     </block>
  </target>
  
  <target name="compile j2ee" dir="TJWS_HOME" comment="J2EE deployer and supporter compilation">
    <dependency target="compile"/>
    <dependency target="idl"/>
    <dependency target="create j2ee sources" process_only="yes"/>
    <dependency variable="j2ee sources"/>
    <echo>Compiling J2EE...</echo>
    <task exec="javac">
       <parameter value="-classpath"/>
       <parameter variable="j2ee class path"/>
       <parameter value="-source"/>
       <parameter variable="j2ee target version"/>
       <parameter value="-target"/>
       <parameter variable="j2ee target version"/>
       <parameter>
          <expression>
            <if>
              <expression>
                <operator name="or">
                  <operator name="lt">
                     <value variable="j2ee target version"/>
                     <value>1.6</value>
                  </operator>
                  <operator name="eq">
                     <value variable="android"/>
                     <value>yes</value>
                  </operator>
                </operator>
              </expression>
              <block type="then">
                 <if>
                   <expression>
                     <operator name="eq">
                       <value variable="android"/>
                       <value>yes</value>
                     </operator>
                   </expression>
                   <then>
                      <expression name="target j2ee runtime">
                        <value variable="ANDROID_RT"/>
                      </expression>

                      <expression name="j2ee sources">
                        <operator name="exclude">
                          <value variable="j2ee sources"/>
                          <value>.*rogatkin[/|\\]?app.*</value>
                        </operator>
                      </expression>

                   </then>
                 </if>
                 <operator name="array">
                   <value>-bootclasspath</value>
                   <value variable="target j2ee runtime"/>
                 </operator>
              </block>
            </if>   
          </expression>
       </parameter> 
       <parameter value="-d"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter>
          <expression>
            <if>
              <expression>
                 <operator name="eq">
                    <value variable="j2ee sources"/>
                    <operator name="array"></operator>
                 </operator>
              </expression>
              <block type="else">
                 <value variable="j2ee sources"/>
              </block>
              <block type="then">
                 <value>src/rogatkin/web/WarRoller.java</value>
              </block>
           </if>
          </expression>
       </parameter> 
      <onexit>
        <if>
          <expression>
             <operator name="neq"><value variable="resultcode"/><value>0</value></operator>
          </expression>
          <block type="then">
                 <echo>Error(s) at compilation</echo>
                 <function name="stop">
			<parameter value="1"/>
                 </function>
          </block>
       </if>
      </onexit>
    </task>
  </target>


  <target name="compile oracle connection checker" dir="TJWS_HOME" comment="a small Oracle JDBC connection validity checker">
    <dependency target="check lib"/>
    <dependency variable="checker sources"/>
    <echo>Compiling checker...</echo>
    <task exec="javac">
       <parameter value="-source"/>
       <parameter>1.5</parameter>
       <parameter value="-target"/>
       <parameter>1.5</parameter>
       <parameter value="-d"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter variable="checker sources"/>
    </task>
  </target>
  
  <target name="war" dir="TJWS_HOME" comment="creation jar of J2EE deployer and supporter">
    <echo>Jarring war...</echo>
    <dependency target="compile j2ee"/>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/rogatkin/web" type="dir"/>
              <parameter value="&build_directory;/war.jar" type="file"/>
           </function>
    </dependency>
    <task name="jar_do" code="sun.tools.jar.Main">
       <parameter value="-cf"/>
       <parameter value="&build_directory;/war.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="rogatkin/web" type="dir"/>
    </task>
  </target>


  <target name="wskt" dir="TJWS_HOME" comment="creation jar of websocket supporter">
    <echo>Jarring wskt...</echo>
    <dependency target="compile j2ee"/>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/rogatkin/wskt" type="dir"/>
              <parameter value="&build_directory;/wskt.jar" type="file"/>
           </function>
    </dependency>
    <task name="jar_do" code="sun.tools.jar.Main">
       <parameter value="-cf"/>
       <parameter value="&build_directory;/wskt.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="rogatkin/wskt" type="dir"/>
       <parameter value="-C"/>
       <parameter value="resources" type="dir"/>
       <parameter value="META-INF/services/javax.websocket.server.ServerEndpointConfig$Configurator" type="dir"/>
    </task>
  </target>

  <target name="app" dir="TJWS_HOME" comment="creation jar of J2EE app server tools, like JNDI, DataSource, and other">
    <echo>Jarring app...</echo>
    <dependency target="compile j2ee"/>
    <dependency target="checker"/>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/rogatkin/app" type="dir"/>
              <parameter value="&build_directory;/app.jar" type="file"/>
           </function>
    </dependency>
    <task name="jar_do" code="sun.tools.jar.Main">
       <parameter value="-cf"/>
       <parameter value="&build_directory;/app.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="rogatkin/app" type="dir"/>
    </task>
  </target>

  <target name="checker" dir="TJWS_HOME" comment="build a jar for Oracle JDBC connection checker">
     <dependency target="compile oracle connection checker"/>
     <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/oracle" type="dir"/>
              <parameter value="&build_directory;/conn_chk.jar" type="file"/>
           </function>
     </dependency>
     <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/mysql" type="dir"/>
              <parameter value="&build_directory;/conn_chk.jar" type="file"/>
           </function>
     </dependency>
     <echo>Jarring checker....</echo>
     <task 
       name="jar_chk_do" code="sun.tools.jar.Main">
         <parameter value="-cf"/>
         <parameter value="&build_directory;/conn_chk.jar" type="file"/>
         <parameter value="-C"/>
         <parameter value="&build_directory;" type="dir"/>
         <parameter value="oracle" type="dir"/>
         <parameter value="-C"/>
         <parameter value="&build_directory;" type="dir"/>
         <parameter value="mysql" type="dir"/>
     </task>
  </target>
  
  <target name="jar" dir="TJWS_HOME" comment="Creation jar of main server">
    <echo>Jarring...</echo>
    <dependency target="compile"/>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;\Acme" type="dir"/>
              <parameter value="&build_directory;\webserver.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="bee.xml" type="dir"/>
              <parameter value="&build_directory;\webserver.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/manifest.mf" type="file"/>
              <parameter value="&build_directory;\webserver.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/Acme/Resource" type="file"/>
              <parameter value="&build_directory;\webserver.jar" type="file"/>
           </function>
    </dependency>
    <task name="jar_do" code="sun.tools.jar.Main">
       <parameter value="-cmf"/>
       <parameter value="src/manifest.mf" type="file"/>
       <parameter value="&build_directory;/webserver.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="Acme" type="dir"/>
       <parameter value="-C"/>
       <parameter value="src" type="dir"/>
       <parameter value="Acme/Resource" type="dir"/>
    </task>
  </target>

  <target name="conv res" dir="TJWS_HOME" comment="convert properties with national charcters to Java properties encoding">
     <dependency>
        <expression name="res list">
           <function name="newerthan">
              <parameter value="src/rogatkin/resource/.asis" type="path"/>
              <parameter value="src/rogatkin/resource/.properties" type="path"/>
           </function>
        </expression>
     </dependency>
     <block>
        <echo>Converting resources</echo>
        <expression variable="prop files">
              <value type="file">src/rogatkin/resource/*.asis</value>
        </expression>
        <expression variable="java tool classes">
           <operator name="append">
             <value variable="JAVA_HOME"/>
             <value>/lib/tools.jar</value>
           </operator>
        </expression>
        
        <for variable="prop file" in="prop files">
          <task name="main" code="sun.tools.native2ascii.Main" path="java tool classes">
              <parameter value="-encoding"/>
              <parameter value="utf-8"/>
              <parameter variable="prop file"/>
              <parameter>
                 <operator name="append">
                    <value type="dir">src/rogatkin/resource</value>
                    <value name="file.separator" type="property"/>
                    <function name="filename">
                       <parameter variable="prop file"/>
                    </function>
                    <value>.properties</value>
                 </operator>
              </parameter>
          </task>
        </for>
     </block>
  </target>

  <!--  variable for building combined jar  -->

  <expression variable="servlet properties">
     <operator name="append">
        <value variable="SERVLET_SRC"/>
        <value>/javax/servlet/LocalStrings*.properties</value>
     </operator>
  </expression>

  <expression variable="servlet http properties">
     <operator name="append">
        <value variable="SERVLET_SRC"/>
        <value>/javax/servlet/http/LocalStrings*.properties</value>
     </operator>
  </expression>

  <expression variable="servlet res root">
     <operator name="append">
        <value variable="SERVLET_SRC"/>
     </operator>
  </expression>

  <expression variable="servlet src mask">
           <function name="cropname">
              <parameter variable="SERVLET_SRC"/>
              <parameter value="(\\)|(\.)|(\-)"/>
              <parameter value="\\$1$2$3"/>
              <parameter value="a"/>
           </function>
  </expression>
 
  <expression>
    <for variable="n mask" in="servlet src mask">
       <expression variable="servlet src mask">
         <value variable="n mask"/>
       </expression>
    </for>
  </expression>

  <!--echo variable="servlet src mask"/-->

  <expression variable="resource list">
           <function name="cropname">
              <parameter variable="servlet properties"/>
              <parameter variable="servlet src mask"/>
           </function>
  </expression>

  <expression variable="resource http list">
           <function name="cropname">
              <parameter variable="servlet http properties"/>
              <parameter variable="servlet src mask"/>
           </function>
  </expression>
  
  <expression variable="systray properties">
           <function name="cropname">
              <parameter value="src/rogatkin/resource/*.properties"/>
              <parameter>src</parameter>
           </function>
  </expression>

  <target name="launcher" dir="TJWS_HOME" comment="build one jar web app launcher">
    <dependency target="jar"/>
    <dependency target="war"/>
    <dependency target="wskt"/>
    <dependency target="conv res"/>
    <dependency>
           <function name="allnewer">
              <parameter value="src/webapp.mf" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/rogatkin/resource/*.gif" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/rogatkin/resource/*.properties" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="bee.xml" type="dir"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;\war.jar" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;\webserver.jar" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/wskt.jar" type="file"/>
              <parameter value="&build_directory;/&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <block>
    <task name="jar launcher" code="sun.tools.jar.Main">
       <parameter value="-cmf"/>
       <parameter value="src/webapp.mf" type="file"/>
       <parameter value="&build_directory;/&launchername;.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="Acme" type="dir"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="rogatkin" type="dir"/>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>Acme/Resource/mime.properties</parameter>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>rogatkin/resource/tjws.gif</parameter>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>rogatkin/resource/splash.gif</parameter>
       <parameter value="-C"/>
       <parameter variable="SERVLET_BUILD" type="dir"/>
       <parameter value="javax" type="dir"/>
       <parameter>
           <expression variable="resources">
              <variable name="resources"/>
              <for variable="resource name" in="resource list">
                  <operator name="array" variable="resources">
                      <value variable="resources"/>
                      <value>-C</value>
                      <value variable="servlet res root"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter>
           <expression variable="resources">
              <variable name="resources"/>
              <for variable="resource name" in="resource http list">
                  <operator name="array" variable="resources">
                      <value variable="resources"/>
                      <value>-C</value>
                      <value variable="servlet res root"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter>
           <expression variable="properties">
              <variable name="properties"/>
              <for variable="resource name" in="systray properties">
                  <operator name="array" variable="properties">
                      <value variable="properties"/>
                      <value>-C</value>
                      <value variable="src"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter value="-C"/>
       <parameter>
         <expression>
             <operator name="append">
                <value variable="WEBSOCKET_API" type="dir"/>
                <value>/client/lib</value>
             </operator>
         </expression>
       </parameter>    
       <parameter value="javax/websocket" type="dir"/>
       <parameter value="-C"/>
       <parameter>
         <expression>
             <operator name="append">
                <value variable="WEBSOCKET_API" type="dir"/>
                <value>/server/lib</value>
             </operator>
         </expression>
       </parameter>    
       <parameter value="javax/websocket/server" type="dir"/>
       <parameter value="-C"/>
       <parameter variable="CLASS_SCAN_CLASSES" type="dir"/>
       <parameter value="io" type="dir"/>
    </task>
    <if>
      <expression>
         <operator name="neq">
           <value variable="JASPER_BUILD"/>
           <value>JASPER_BUILD</value>
         </operator>
      </expression>
      <block type="then">
       <echo>Adding Jasper</echo>
       <task name="jar jasper" code="sun.tools.jar.Main">
       <parameter value="-uf"/>
       <parameter value="&build_directory;/&launchername;.jar" type="file"/>
       <parameter value="-C"/>
       <parameter variable="JASPER_BUILD" type="dir"/>
       <parameter value="org" type="dir"/>
       <parameter value="-C"/>
       <parameter variable="JASPER_BUILD" type="dir"/>
       <parameter value="javax/servlet/jsp" type="dir"/>
       <parameter value="-C"/>
       <parameter variable="JASPER_BUILD" type="dir"/>
       <parameter value="javax/el" type="dir"/>
       <parameter value="-C"/>
       <parameter variable="JASPER_SRC" type="dir"/>
       <parameter>org/apache/jasper/resources</parameter>
       </task>
      </block>
    </if>
    </block>
    <echo>Launcher's been built.</echo>
  </target>

  <target name="aslauncher" dir="TJWS_HOME" comment="build one jar web app launcher with services">
    <dependency target="app"/>
    <dependency target="conv res"/>
    <dependency>
           <function name="allnewer">
              <parameter value="src/appserver.mf" type="file"/>
              <parameter value="&build_directory;\as&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/rogatkin/resource/*.gif" type="file"/>
              <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="src/rogatkin/resource/*.properties" type="file"/>
              <parameter value="&build_directory;\&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="bee.xml" type="dir"/>
              <parameter value="&build_directory;\as&launchername;.jar" type="file"/>
           </function>
    </dependency>
    <block>
    <task name="jar aslauncher" code="sun.tools.jar.Main">
       <parameter value="-cmf"/>
       <parameter value="src/appserver.mf" type="file"/>
       <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="Acme" type="dir"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="dir"/>
       <parameter value="rogatkin" type="dir"/>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>rogatkin/resource/tjws.gif</parameter>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>rogatkin/resource/splash.gif</parameter>
       <parameter value="-C"/>
       <parameter value="src" type="file"/>
       <parameter>Acme/Resource/mime.properties</parameter>
       <parameter value="-C"/>
       <parameter variable="SERVLET_BUILD" type="dir"/>
       <parameter value="javax" type="dir"/>
       <parameter>
           <expression variable="resources">
              <variable name="resources"/>
              <for variable="resource name" in="resource list">
                  <operator name="array" variable="resources">
                      <value variable="resources"/>
                      <value>-C</value>
                      <value variable="servlet res root"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter>
           <expression variable="resources">
              <variable name="resources"/>
              <for variable="resource name" in="resource http list">
                  <operator name="array" variable="resources">
                      <value variable="resources"/>
                      <value>-C</value>
                      <value variable="servlet res root"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter>
           <expression variable="properties">
              <variable name="properties"/>
              <for variable="resource name" in="systray properties">
                  <operator name="array" variable="properties">
                      <value variable="properties"/>
                      <value>-C</value>
                      <value variable="src"/>
                      <value variable="resource name"/>
                  </operator>
               </for>
           </expression>
       </parameter>
       <parameter value="-C"/>
       <parameter>
         <expression>
             <operator name="append">
                <value variable="WEBSOCKET_API" type="dir"/>
                <value>/client/lib</value>
             </operator>
         </expression>
       </parameter>    
       <parameter value="javax/websocket" type="dir"/>
       <parameter value="-C"/>
       <parameter>
         <expression>
             <operator name="append">
                <value variable="WEBSOCKET_API" type="dir"/>
                <value>/server/lib</value>
             </operator>
         </expression>
       </parameter>    
       <parameter value="javax/websocket/server" type="dir"/>
       <parameter value="-C"/>
       <parameter variable="CLASS_SCAN_CLASSES" type="dir"/>
       <parameter value="io" type="dir"/>
    </task>
    <if>
      <expression>
         <operator name="neq">
           <value variable="JASPER_BUILD"/>
           <value>JASPER_BUILD</value>
         </operator>
      </expression>
      <block type="then">
       <echo>Adding Jasper</echo>
       <task name="jar jasper" code="sun.tools.jar.Main">
         <parameter value="-uf"/>
         <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
         <parameter value="-C"/>
         <parameter variable="JASPER_BUILD" type="dir"/>
         <parameter value="org" type="dir"/>
         <parameter value="-C"/>
         <parameter variable="JASPER_BUILD" type="dir"/>
         <parameter value="javax/servlet/jsp" type="dir"/>
         <parameter value="-C"/>
         <parameter variable="JASPER_BUILD" type="dir"/>
         <parameter value="javax/el" type="dir"/>
         <parameter value="-C"/>
         <parameter variable="JASPER_SRC" type="dir"/>
         <parameter>org/apache/jasper/resources</parameter>
       </task>
      </block>
      <else>
         <echo>No JSP support added in the launcher</echo>
      </else>
    </if>
    </block>
    <echo>App Server Launcher's been built.</echo>
  </target>

  <target name="embedded" dir="TJWS_HOME" comment="build one jar web application">
    <dependency target="launcher"/>
    <dependency value="true"/>
    <block>
       <expression variable="CLA">
         <function name="ask">
            <parameter>Enter command line arguments for app [-nohup -p 8080]? </parameter>
            <parameter>-nohup -p 8080</parameter>
         </function>
       </expression>
       <expression variable="app war">
         <function name="ask">
            <parameter>Enter application .war file location? </parameter>
            <parameter></parameter>
         </function>
       </expression>
       <expression variable="app icon">
         <function name="ask">
            <parameter>Enter application icon (32x32 gif image file) location[src/rogatkin/resource/tjws.gif]? </parameter>
            <parameter type="path">src/rogatkin/resource/tjws.gif</parameter>
         </function>
       </expression>
       <expression variable="include tools">
         <function name="ask">
            <parameter>Do you need tools.jar added (Java compiler for JSP) [n]? </parameter>
            <parameter>n</parameter>
         </function>
       </expression>
       <if>
          <expression>
             <operator name="neq">
                 <value variable="include tools"/>
                 <value>n</value>
             </operator>
          </expression>
          <then>
            <echo>Please precompile your JSP using a command similar to bellow (Jasper):
bee -- -webapp &lt;web app dir&gt; -v -d &lt;target dir&gt;  -compile</echo>
          </then>
       </if>
       <function name="write">
         <parameter>rundescriptor</parameter>
         <parameter variable="CLA"/>
         <parameter>
</parameter>
         <parameter>
            <function name="filename">
              <parameter variable="app war"/>
            </function>
         </parameter>
         <parameter>.war</parameter>
       </function>
       <task name="jar launcher" code="sun.tools.jar.Main">
          <parameter value="-uf"/>
          <parameter value="&build_directory;/&launchername;.jar" type="file"/>
          <parameter>rundescriptor</parameter>
          <parameter>-C</parameter>
          <parameter>
             <function name="cropname">
                 <parameter variable="app war"/>
                 <parameter>
                    <expression>
                       <operator name="append">
                         <function name="filename">
                            <parameter variable="app war"/>
                         </function>
                         <value>\..*</value>
                       </operator>
                    </expression>
                 </parameter>
             </function>
          </parameter>
          <parameter>
             <expression>
                <operator name="append">
                   <function name="filename">
                     <parameter variable="app war"/>
                   </function>
                   <value>.war</value>
                </operator>
             </expression>
          </parameter>
       </task>
       <expression variable="app jar">
          <operator name="append">
            <value>&build_directory;/</value>
            <function name="filename">
              <parameter variable="app war"/>
            </function>
            <value>.jar</value>
          </operator>
       </expression>
       <function name="rm">
          <parameter>rundescriptor</parameter>
          <parameter variable="app jar"/>
       </function>
       <function name="mv">
          <parameter value="&build_directory;/&launchername;.jar" type="file"/>
          <parameter variable="app jar"/>
       </function> 
    </block>
  </target>

  <target name="asembedded" dir="TJWS_HOME" comment="build one jar web application with services">
    <dependency target="aslauncher"/>
    <dependency value="true"/>
    <block>
       <expression variable="CLA">
         <function name="ask">
            <parameter>Enter command line arguments for app server, use
-j org.apache.jasper.servlet.JspServlet -org.apache.jasper.servlet.JspServlet.classpath %classpath% -org.apache.jasper.servlet.JspServlet.scratchdir %deploydir%/WEB-INF            
for Jasper enabled application [-nohup -p 80 -dataSource datasource.properties]? </parameter>
            <parameter>-nohup -p 80 -dataSource datasource.properties</parameter>
         </function>
       </expression>
       <expression variable="app war">
         <function name="ask">
            <parameter>Enter application .war file location? </parameter>
            <parameter></parameter>
         </function>
       </expression>
       <function name="write">
         <parameter>rundescriptor</parameter>
         <parameter variable="CLA"/>
         <parameter>
</parameter>
         <parameter>
            <function name="filename">
              <parameter variable="app war"/>
            </function>
         </parameter>
         <parameter>.war</parameter>
       </function>
       <task name="as jar launcher" code="sun.tools.jar.Main">
          <parameter value="-uf"/>
          <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
          <parameter>rundescriptor</parameter>
          <parameter>-C</parameter>
          <parameter>
             <function name="cropname">
                 <parameter variable="app war"/>
                 <parameter>
                    <expression>
                       <operator name="append">
                         <function name="filename">
                            <parameter variable="app war"/>
                         </function>
                         <value>\..*</value>
                       </operator>
                    </expression>
                 </parameter>
             </function>
          </parameter>
          <parameter>
             <expression>
                <operator name="append">
                   <function name="filename">
                     <parameter variable="app war"/>
                   </function>
                   <value>.war</value>
                </operator>
             </expression>
          </parameter>
       </task>
       <expression variable="app jar">
          <operator name="append">
            <value>&build_directory;/</value>
            <function name="filename">
              <parameter variable="app war"/>
            </function>
            <value>.jar</value>
          </operator>
       </expression>
       <function name="rm">
          <parameter>rundescriptor</parameter>
          <parameter variable="app jar"/>
       </function>
       <function name="mv">
          <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
          <parameter variable="app jar"/>
       </function> 
    </block>
  </target>

  <target name="clean" dir="TJWS_HOME" comment="clean all build results">
    <dependency>
       <expression>
         <operator name="eq">
            <value>y</value>  
            <function name="ask">
               <parameter value="Are you sure to remove all files in &build_directory; [n]?"/>
               <parameter value="n"/>
            </function>
        </operator>
      </expression>
    </dependency>
    <block>
      <echo>Cleaning...</echo>
      <function name="rm">
         <parameter value="&build_directory;/*/*/*/*.class" type="dir"/>
         <parameter value="&build_directory;/webserver.jar" type="file"/>
         <parameter value="&build_directory;/&launchername;.jar" type="file"/>
         <parameter value="&build_directory;/as&launchername;.jar" type="file"/>
         <parameter value="&build_directory;/war.jar" type="file"/>
         <parameter value="&build_directory;/wskt.jar" type="file"/>
         <parameter value="&build_directory;/app.jar" type="file"/>
         <parameter value="&build_directory;/conn_chk.jar" type="file"/>
         <parameter value="src/rogatkin/app/remote/*.java" type="dir"/>
      </function>
    </block>
  </target>

  <target name="gencert" dir="TJWS_HOME" comment="Generate SSL certificate">
     <echo>Generation SSL certificate</echo>
     <block>
       <variable name="keystore path"/>
       <variable name="keystore pass"/>
       <expression name="keystore path">
          <operator name="append">
            <value name="user.home" type="property"/>
            <value>/.keystore</value>
          </operator>
       </expression>
       <expression name="keystore path">
          <function name="ask">
            <parameter>Keystore path[~/.keystore]? </parameter>
            <parameter type="path" variable="keystore path" />
          </function>
       </expression> 
       <expression name="keystore pass">
          <function name="ask">
            <parameter>Keystore password[changeme]? </parameter>
            <parameter>changeme</parameter>
          </function>
       </expression> 
       <expression name="keystore provider">
          <function name="ask">
            <parameter>Keystore provider (use default for BKS/Android, or JKS for standard) [org.bouncycastle.jce.provider.BouncyCastleProvider]? </parameter>
            <parameter>org.bouncycastle.jce.provider.BouncyCastleProvider</parameter>
          </function>
       </expression> 
       <expression name="key alias">
          <function name="ask">
            <parameter>Key alias name[selfsigned]? </parameter>
            <parameter>selfsigned</parameter>
          </function>
       </expression> 

       <expression name="keytool">
          <operator name="append">
            <value variable="JAVA_HOME"/>
            <value>/bin/keytool</value>
          </operator>
       </expression>
       <expression name="BC cp">
          <operator name="append">
            <value variable="BC_PROVIDER_LIB"/>
            <!--value>bcprov-jdk16-146.jar</value-->
          </operator>
       </expression>
       <task exec="keytool">
         <parameter>-genkeypair</parameter>
         <parameter>-keyalg</parameter>
         <parameter>RSA</parameter>
         <parameter>-validity</parameter>
         <parameter>360</parameter>
         <parameter>-alias</parameter>
         <parameter variable="key alias"/>
         <parameter>-keypass</parameter>
         <parameter variable="keystore pass"/>
         <parameter>-storepass</parameter>
         <parameter variable="keystore pass"/>
         <parameter>-keystore</parameter>
         <parameter variable="keystore path"/>
         <parameter>
           <expression>
             <if>
               <expression>
                 <operator name="neq">
                    <value>JKS</value>
                    <value variable="keystore provider"/>
                 </operator>  
               </expression>
               <then>
                  <operator name="array">
                    <value>-storetype</value>
                    <value>BKS</value>
                    <value>-provider</value>
                    <value variable="keystore provider"/>
                    <value>-providerpath</value>
                    <value variable="BC cp"/>
                 </operator>
               </then>
             </if>
           </expression>
         </parameter>
         <!--parameter>-keysize</parameter>
         <parameter>2048</parameter-->
       </task>
     </block>
  </target>

  <expression variable="run class path">
     <operator name="append">
        <value variable="TJWS_HOME"/>
        <value>/&build_directory;/webserver.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/&build_directory;/war.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/&build_directory;/wskt.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="j2ee class path"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="JAVA_HOME"/>
        <value>/lib/tools.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="JSP_LIB"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="JSP_SERVLET"/>
        <expression>
           <if>
             <expression>
                <operator name="neq">
                   <value variable="JASPER"/>
                   <value/>
                </operator>
             </expression>
             <block type="then">
                <operator name="append">
                  <value variable="PATH SEPARATOR"/>
                  <value variable="JASPER"/>
                  <value variable="PATH SEPARATOR"/>
                  <value variable="APACHE_COMMONS_LOGGING"/>
                  <value variable="PATH SEPARATOR"/>
                  <value variable="APACHE_COMMONS_EL"/>
                </operator>
             </block> 
           </if>
        </expression>
     </operator>
  </expression>

  <expression variable="run app class path">
     <operator name="append">
        <value variable="run class path"/>
        <value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/&build_directory;/app.jar</value>
        <!--value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/&build_directory;/conn_chk.jar</value  becasue the library has to be added in driver's class path-->
     </operator>
  </expression>

  <target name="runtest" dir="TJWS_HOME" comment="run Utils test">
    <dependency target="jar"/>
    <dependency value="true"/>
    <echo>Runs test..</echo>
    <task name="main" code="Acme.Utils" path="run app class path">
      <parameter variable="~#args#~"/>
    </task>
  </target>

  <target name="endpoints" dir="TJWS_HOME" comment="scans websocket endpoints for mobile deployment">
    <dependency target="wskt"/>
    <dependency value="true"/>
    <echo>Scanning and generatiing endpoints list...</echo>
    <task name="main" code="rogatkin.wskt.EndPointScanner" path="run app class path">
      <parameter variable="~#args#~"/>
    </task>
  </target>


  <target name="runapp" dir="TJWS_HOME" comment="run jndi test">
    <dependency target="jar"/>
    <dependency target="app"/>
    <dependency target="war"/>
    <dependency target="wskt"/>
    <dependency value="true"/>
    <!-- TODO add check if android is set  -->
    <task name="main" code="rogatkin.app.Main" path="run app class path">
      <parameter name="com.sun.management.jmxremote"/>
      <parameter name="tjws.wardeploy.dynamically" value="10"/>
      <parameter name="tjws.wardeploy.as-root" value="ROOT"/>
      <parameter name="tjws.proxy.ssl">n</parameter>
      <parameter name="java.naming.provider.url" value="http://localhost:2012"/>
      <parameter name="javamelody.datasources" value="java:comp/env/jdbc/mysql/resumefair"/>
      <parameter>-dataSource</parameter>
      <parameter>mediachest_ds.properties</parameter>
      <!-- ***************  apps debugging  ****************  -->
      <parameter>-dataSource</parameter>
      <parameter>datasource.properties</parameter>
      <!-- ***************  ================ ****************  -->
      <parameter>-p</parameter>
      <parameter>
        <expression>
          <if>
              <expression>
                 <operator name="eq">
                   <value>/</value>
                   <value name="file.separator" type="property"/>
                 </operator>
              </expression>
              <then>
                 <variable name="port">8080</variable>
              </then>
              <else>
                <variable name="port">80</variable>
              </else>
           </if>
          </expression>
      </parameter>
      <parameter>-z</parameter>
      <parameter>50</parameter>
      <parameter>-sh</parameter>
      <!--parameter value="-nka"/-->
      <parameter value="-acceptorImpl"/>
      <parameter value="Acme.Serve.SelectorAcceptor"/>
      <parameter value="-j"/>
      <parameter value="org.apache.jasper.servlet.JspServlet"/>
      <parameter value="-org.apache.jasper.servlet.JspServlet.classpath"/>
      <parameter value="%classpath%"/>
      <parameter value="-org.apache.jasper.servlet.JspServlet.scratchdir"/>
      <parameter value="%deploydir%/WEB-INF"/>
      <parameter variable="~#args#~"/>
    </task>
  </target>

  <target name="run" dir="TJWS_HOME" comment="run server">
    <echo>Running...</echo>
    <dependency target="jar"/>
    <dependency target="war"/>
    <dependency target="wskt"/>
    <dependency value="true"/>
    <task name="main" code="Acme.Serve.Main" path="run class path">
       <parameter name="rogatkin.webapp.debug" value="no"/>
       <parameter name="tjws.wardeploy.warname-as-context" value="yes"/>
       <parameter name="tjws.virtual" value=""/>
       <parameter name="tjws.wardeploy.as-root" value="webdav"/>
       <parameter name="tjws.wardeploy.as-root.localhost" value="redirector"/>
       <parameter name="tjws.serve.log.encoding" value="UTF-8"/>
       <parameter name="tjws.wardeploy.dynamically" value="10"/>
<!--parameter name="tjws.webappdir">/temp/tjws-web-apps</parameter-->
       <!--parameter name="tjws.fileservlet.suppressindex" value=""/-->
       <parameter name="org.apache.commons.logging.LogFactory" value="org.apache.commons.logging.impl.LogFactoryImpl"/>
       <parameter name="org.apache.commons.logging.simplelog.defaultlog" value="error" type="property"/>
       <parameter name="org.apache.commons.logging.Log" value="org.apache.commons.logging.impl.SimpleLog"/>
       <parameter name="tjws.fileservlet.usecompression" value=""/>
       <parameter name="tjws.websocket.container" value="true"/>
       <!--parameter name="jaxp.debug" value="1"/-->
       <!--parameter value="-nka"/-->
       <parameter value="-sp"/>
       <parameter value="-g"/>
       <parameter value="200001"/>
       <parameter value="-a"/>
       <parameter value="aliases.properties"/>
       <parameter value="-b"/>
       <parameter value="0.0.0.0"/>
       <!--parameter value="-s"/>
       <parameter value="servlets.properties"/-->
       <parameter value="-r"/>
       <parameter value="realm.properties"/>
       <parameter value="-p"/>
       <parameter>
         <expression>
           <if>
             <expression>
               <value name="secure" type="property"/>
             </expression>
             <block type="then">
					<if>
						<expression>
							<operator name="eq">
								<value>/</value>
								<value name="file.separator" type="property" />
							</operator>
						</expression>
						<then>
							<variable name="port">8443</variable>
						</then>
						<else>
							<variable name="port" value="443" />
						</else>
					</if>
			 </block>
             <block type="else">
               <if>
                  <expression>
                     <operator name="eq">
                       <value>/</value>
                       <value name="file.separator" type="property"/>
                     </operator>
                  </expression>
                  <then>
                     <variable name="port">8080</variable>
                  </then>
                  <else>
                    <variable name="port">80</variable>
                  </else>
               </if>   
             </block>
           </if>
         </expression>
       </parameter>
       <parameter value="-z"/>
       <parameter value="50"/>
       <parameter value="-l"/>
       <parameter>
          <expression>
                 <if>
                   <expression>
                     <operator name="neq">
                       <value variable="JASPER"/>
                       <value>JASPER</value>
                     </operator>
                   </expression>
                   <block type="then">
                     <operator name="array">
                       <value value="-j"/>
                       <value value="org.apache.jasper.servlet.JspServlet"/>
                       <value value="-org.apache.jasper.servlet.JspServlet.classpath"/>
                       <value value="%classpath%"/>
                       <value value="-org.apache.jasper.servlet.JspServlet.scratchdir"/>
                       <value value="%deploydir%/META-INF/jsp-classes"/>
                     </operator>
                   </block>
                 </if>
          </expression>
       </parameter> 
       <parameter value="-k"/>
       <parameter value="200"/>
       <parameter value="-z"/>
       <parameter value="100"/>
       <parameter value="-c"/>
       <parameter value="cgi-bin"/>
       <!--parameter value="-out"/>
       <parameter value="Acme.Utils$DummyPrintStream"/-->
       <parameter>
          <expression variable="secure socket">
           <if>
             <expression>
               <value name="secure" type="property"/>
             </expression>
             <block type="then">
                <expression variable="secure socket">
                  <operator name="array">
                      <value>-acceptorImpl</value>
                      <!--
                      <value>Acme.Serve.SSLAcceptor</value>
                      -->
                      <value>rogatkin.wskt.SSLSelectorAcceptor</value>
                      <value>-keystorePass</value>
                      <value variable="keystore pass"/>
                  </operator>
                </expression>
             </block>
             <block type="else">
                <expression>
                  <operator name="array">
                      <value>-acceptorImpl</value>
                      <value>Acme.Serve.SelectorAcceptor</value>
                      <!--value>Acme.Serve.SimpleAcceptor</value-->
                  </operator>
                </expression>
             </block>
           </if>
         </expression>
       </parameter>
       <parameter>
          <expression variable="double socket">
           <if>
             <expression>
               <value name="doublehead" type="property"/>
             </expression>
             <block type="then">
                <expression variable="secure socket">
                  <operator name="array">
                      <value>-acceptorImpl</value>
                      <value>rogatkin.web.DualSocketAcceptor</value>
                      <value>-keystorePass</value>
                      <value variable="keystore pass"/> 
                      <value>-ssl-port</value>
                      <value>443</value>
                  </operator>
                </expression>
             </block>
           </if>
         </expression>
      </parameter>
    </task>
  </target>  
</bee>

 